# Achievement API

API для управления достижениями пользователей с поддержкой локализации (ru/en).  
Проект реализован на **FastAPI + SQLAlchemy (async) + PostgreSQL**.  
Включает в себя полный набор CRUD-операций, выдачу достижений, статистику и локализацию.

## Стек технологий

- Python 3.10+
- FastAPI
- SQLAlchemy 2.0 (async)
- Alembic (миграции)
- PostgreSQL
- Pydantic (валидация)
- Docker / docker-compose (опционально)
- pytest (тестирование)

## Функциональность

- **Пользователи**: создание, получение по ID, получение списка всех пользователей.
- **Достижения**: создание (с переводами на несколько языков), получение списка всех достижений (с переводами).
- **Выдача достижений**: привязка достижения к пользователю с фиксацией даты.
- **Достижения пользователя**: получение списка с локализацией на указанный язык (по умолчанию язык пользователя).
- **Статистика**:
  - Пользователь с максимальным количеством достижений.
  - Пользователь с максимальной суммой баллов.
  - Пара пользователей с максимальной разностью баллов.
  - Пара пользователей с минимальной разностью баллов.
  - Пользователи, получавшие достижения 7 дней подряд.

## Запуск проекта

### Локально

1. **Клонировать репозиторий**  
   ```bash
   git clone <url>
   cd fastpaiwithbd
   ```
2. **Создать и активировать виртуальное окружение**
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/Mac
   venv\Scripts\activate     # Windows
   ```
3. **Установить зависимости**
   ```bash
   pip install -r requirements.txt
   ```
4. **Настройка базы данных**
    - **Установите PostgreSQL и создайте базу данных, например achievements_db.**
    - **Скопируйте .env.example в .env и укажите параметры подключения:**
   ```bash
   DB_HOST=localhost
    DB_PORT=5432
    DB_NAME=achievements_db
    DB_USER=postgres
    DB_PASSWORD=postgres
    DEBUG=True
    LOG_LEVEL=INFO
   ```
5. **Применить миграции**
    ```bash
    alembic upgrade head
    ```
6. **Запустить сервер**
   ```bash
   uvicorn app.main:app --reload
   ```
   ## Сервер будет доступен по адресу http://localhost:8000.
   ## Документация Swagger: http://localhost:8000/docs

# Через Docker
1. **Запустить docker engine**
2. **В корне проекта выполните:**
   ```bash
   docker-compose up --build
   ```
## Приложение будет доступно на http://localhost (через nginx) или http://localhost:8000 (напрямую).
## База данных будет создана автоматически, миграции применятся при старте.

# API Endpoints

# Пользователи

| Метод | URL                                         | Описание                                    |
|-------|---------------------------------------------|---------------------------------------------|
| POST  | `/api/v1/users`                             | Создать пользователя                        |
| GET   | `/api/v1/users`                              | Получить всех пользователей                 |
| GET   | `/api/v1/users/{id}`                         | Получить пользователя по ID                 |
| POST  | `/api/v1/users/{id}/achievements/{ach_id}`   | Выдать достижение пользователю              |
| GET   | `/api/v1/users/{id}/achievements?lang={lang}`| Получить достижения пользователя (с локализацией) |

# Пример создания пользователя:

```bash
{
  "username": "alice",
  "language": "en"
}
```

# Достижения
| Метод | URL                                         | Описание                                    |
|-------|---------------------------------------------|---------------------------------------------|
| POST  | `/api/v1/achievements`                             | Создать достижение (с переводами)                        |
| GET   | `/api/v1/achievements`                              | Получить все достижения (с переводами)                 |

# Пример создания достижения

```bash
{
  "points": 10,
  "translations": [
    {"language": "ru", "name": "Победа", "description": "Первая победа"},
    {"language": "en", "name": "Victory", "description": "First victory"}
  ]
}
```

# Статистика 

| Метод | URL                                         | Описание                                    |
|-------|---------------------------------------------|---------------------------------------------|
| GET  | `/api/v1/stats/users/max-achievements-count`                             | Пользователь с макс. количеством достижений                        |
| GET   | `/api/v1/stats/users/max-points`                              | Пользователь с макс. суммой баллов                 |
| GET   | `/api/v1/stats/users/max-points-difference}`                         | Пара с макс. разностью баллов                 |
| GET  | `/api/v1/stats/users/min-points-difference`   | Пара с мин. разностью баллов              |
| GET   | `/api/v1/stats/users/7-days-streak`| ID пользователей со стриком 7+ дней
 |

 # Тестирование

## В корне проекта
 ```bash
pytest tests/ -v
```

   
    
   
   
